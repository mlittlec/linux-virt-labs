# myenvironment.j2 Template Documentation

## Purpose

Generates a YAML configuration file for defining an Oracle CNE environmentâ€”used as a global config source for `olcnectl`/automation-driven cluster bootstrapping.

## How the Template is Used

- Can be rendered by automation to a variable file, then passed to `olcnectl environment create --config-file`.
- Supports single or multi-control-plane, with/without load balancer setup.
- Populates environment, global settings (certs, API endpoint), module configuration, control plane/worker nodes, and all required cluster bootstrap values.

## Key Variables & Substitutions

- `ocne_registry_location`: Container registry address for K8s images.
- `use_lb`, `lb_ip`: Conditional block for inserting LB information.
- `groups['controlplane']`, `groups['worker']`: Jinja2 looped listings to declare all nodes.
- `username`: Used in external IP certificate paths.

### Conditional Blocks

- LB config only included if `use_lb` is true.
- Node lists populated via Jinja2 for-loops.

## Rendered Example (simplified)

```yaml
environments:
  - environment-name: myenvironment
    globals:
      api-server: 127.0.0.1:8091
      ...
    modules:
      - module: kubernetes
        name: mycluster
        args:
          container-registry: registry.example.com/olcne
          load-balancer: 10.0.0.25:6443    # if use_lb
          control-plane-nodes:
            - cp-01:8090
            - cp-02:8090
          worker-nodes:
            - worker-01:8090
          selinux: enforcing
          restrict-service-externalip-ca-cert: /home/myuser/certificates/ca/ca.cert
          restrict-service-externalip-tls-cert: /home/myuser/certificates/restrict_external_ip/node.cert
          restrict-service-externalip-tls-key: /home/myuser/certificates/restrict_external_ip/node.key
```

## Special Logic

- Jinja2 conditionals and loops to insert/exclude or enumerate config values based on deployment/inventory state.
- Suitable for all current automation/olcnectl CLI config requirements.

## Related Files

- May be generated by provision_ocne.yml or for direct operator usage.
- Used by: `olcnectl` environment/module commands with `--config-file`.
